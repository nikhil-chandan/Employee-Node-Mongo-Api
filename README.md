# Example-Node-Mongo-Api

CRUD operation with Node.js(Express Framework) and MongoDB

Best Practices Followed
1. Test Cases Implementation using chai and mocha.
2. Logger Implemented for info as well as errors.
3. Projection of required/not required fields.
4. Error Handling async calls.
5. Making use of custom_id and not using id generated by Mongo-DB.

Installation
- npm i

Test Cases Run
- npm test

Run App
- npm start



function getEmpId() {
    var deferred = Q.defer();
    try {
        Employee.find().sort({employeeId:-1}).limit(1)
        .then(lastEmpId => {
            if (lastEmpId) {
                lastEmpId = lastEmpId[0].employeeId + 1;
                console.log(lastEmpId)
                deferred.resolve(lastEmpId);
            } else {
                //if no emp in db
                lastEmpId = 1;
                deferred.resolve(lastEmpId);
            }
        })
        return deferred.promise;
    } catch (err) {
        logger.error('Unable to get new emp id ' + err.name)
        console.log(err)
    }
}
















var postEmployee = async (req, res) => {
    try {
        getEmpId().then(async function (countEmp) {
            const employee = new Employee({
                firstName: req.body.firstName,
                lastName: req.body.lastName,
                address: req.body.address,
                mobileNo: req.body.mobileNo,
                employeeId: parseInt(countEmp),
                designation: req.body.designation,
                location: req.body.location,
            });
             await employee.save();
            Employee.find({employeeId: parseInt(countEmp)}, projection)
            .then(savedEmployee => {
                if (savedEmployee) {
                    res.json(savedEmployee[0]);
                } 
            })
            logger.info('Employee Details Added with emp id ' + countEmp)
        }).fail(function (err) {
            console.log(err)
        });
    } catch (err) {
        logger.error('Employee were not added' + err.name)
        res.json({
            message: err
        });
    }
}
